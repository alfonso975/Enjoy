<!DOCTYPE html>
<!-- Create By Alfonso Lopez -->
<html>
    <head>
        <title>Enjoy</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" href="img/icon.png" />
        <link rel="stylesheet" href="fuente/comicS.css">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" crossorigin="anonymous">
        <script src="https://kit.fontawesome.com/637f7442f6.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdn.linearicons.com/free/1.0.0/icon-font.min.css">
        <style>
            @font-face {
                font-family: "Comic Sans MS";
                src: url("fuente/comic-sans-ms-4.ttf");
            }
            .loader {
                position: fixed;
                left: 0px;
                top: 0px;
                width: 100%;
                height: 100%;
                z-index: 9999;
                background: url('img/loading.gif') 50% 50% no-repeat rgb(249,249,249);
                background-color: #020000;
                align-items: center;
                display: flex;
                opacity: .9;
                justify-content: center;
            }
        </style>
    </head>
    <body style="background-color: #131313;
          background-size: cover;overflow-x: hidden;
          background-attachment: fixed" class="scrol scrol-thumb">
        <div class="loader" id="loader" style="background-color: #181b22;text-align: center;display: flex">
            <h2 id='loaderMensaje' style="font-size: 40px;text-align: center;color: #2aa58a" class="justify-content-center">
                Procesando pago, por favor espere...
            </h2>
        </div>
        <input id="compdataPub" class="hid" value="false" style="display: none" readonly="readonly">
        <script src="script/cif.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" crossorigin="anonymous"></script>
        <script src="https://momentjs.com/downloads/moment.js"  crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"  crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.33/moment-timezone.min.js" crossorigin="anonymous" ></script>
        <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-auth-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-compat.js"></script>
        <script>
            var firebaseConfig = {
                apiKey: "AIzaSyB9zjuIk3aupb9lxw4kdE10WELo3RflJP0",
                authDomain: "enjoy-13d08.firebaseapp.com",
                databaseURL: "https://enjoy-13d08-default-rtdb.firebaseio.com",
                projectId: "enjoy-13d08",
                storageBucket: "enjoy-13d08.appspot.com",
                messagingSenderId: "259344011433",
                appId: "1:259344011433:web:2766c0f29a97a74da5d9b8"
            };
            firebaseApp = firebase.initializeApp(firebaseConfig);
            var auth = firebase.auth();
            var fire = firebase.firestore();
        </script>
        <script>
            auth.onAuthStateChanged(function (user) {
                if (user) {
                    var mail = user.email;
                    var encripta = cifrar(mail.toString());
                    var rCS = encripta.palabraEncriptada;
                    $(document).ready(function () {
                        urlVariables = location.search.substring(1, location.search.length);
                        separador = "%20";
                        var arrayDeCadenas = urlVariables.split(separador);
                        nombreUrl = arrayDeCadenas[0];
                        var2 = arrayDeCadenas[1];
                        var urlRedireccionar = 'https://enjoythemomentofficial.com/profileUser.html?' + nombreUrl + '';
                        if (var2 === "pta1Xn") {
                            var queryImagenes = firebase.database().ref("Imagenes").orderByChild('nombreU').equalTo(nombreUrl).limitToFirst(1);
                            queryImagenes.on("child_added", function (s) {
                                $("#compdataPub").attr("value", "true");
                            });
                            fire.collection("orders").where("correo", "==", mail)
                                    .get()
                                    .then(function (querySnapshot) {
                                        querySnapshot.forEach(function (doc) {
                                            var publicaciones = doc.data();
                                            var checkoutSessionId = publicaciones.checkoutSessionId;
                                            var paymentStatus = publicaciones.paymentStatus;
                                            if (checkoutSessionId) {
                                                if (paymentStatus === "paid") {
                                                    docID = doc.id;

                                                    var aestTime = new Date().toLocaleString("en-US", {timeZone: "America/Mexico_City"});
                                                    aestTime = new Date(aestTime);
                                                    var newDateOptions = {
                                                        day: "2-digit",
                                                        month: "2-digit",
                                                        year: "numeric"
                                                    };
                                                    var fecha1 = aestTime.toLocaleString("en-US", newDateOptions);
                                                    arrFecha = fecha1.toString();
                                                    separador = "/";
                                                    var arrayDeCadenas = arrFecha.split(separador);
                                                    mes = arrayDeCadenas[0];
                                                    dia = arrayDeCadenas[1];
                                                    year = arrayDeCadenas[2];
                                                    fecha11 = "" + year + "-" + mes + "-" + dia + "";
                                                    fire.collection("orders").doc(docID).delete().then(function () {
                                                        fire.collection("IMAGENES").where("nombre", "==", nombreUrl)
                                                                .get()
                                                                .then(function (querySnapshot) {
                                                                    querySnapshot.forEach(function (doc) {
                                                                        var publicaciones = doc.data();
                                                                        susM = publicaciones.susM;
                                                                        susMInt = parseFloat(susM) - (parseFloat(susM) * .19);
                                                                        fire.collection("IMAGENES").where("mail", "==", rCS)
                                                                                .get()
                                                                                .then(function (querySnapshot) {
                                                                                    querySnapshot.forEach(function (doc) {
                                                                                        var publicaciones = doc.data();
                                                                                        var coinsData = publicaciones.coins;
                                                                                        var nombre = publicaciones.nombre;
                                                                                        var url = publicaciones.foto;
                                                                                        var sigo = publicaciones.sigo;
                                                                                        var seguidos = publicaciones.seguidos;
                                                                                        var uidCS = publicaciones.uid;
                                                                                        if (coinsData) {
                                                                                            if (susM > coinsData) {
                                                                                                docu = publicaciones.uid;
                                                                                                var docRef = fire.collection('IMAGENES').doc(docu);
                                                                                                var newCoins = 0;
                                                                                                var newData = {
                                                                                                    coins: newCoins
                                                                                                };
                                                                                                docRef.update(newData).then(function () {
                                                                                                    fire.collection("IMAGENES").where("nombre", "==", nombreUrl)
                                                                                                            .get()
                                                                                                            .then(function (querySnapshot) {
                                                                                                                querySnapshot.forEach(function (doc) {
                                                                                                                    var publicaciones = doc.data();
                                                                                                                    var rCI = publicaciones.mail;
                                                                                                                    var doc = publicaciones.uid;
                                                                                                                    var docRef = fire.collection('IMAGENES').doc(doc);
                                                                                                                    var contSeg = publicaciones.contSeg;
                                                                                                                    numNot = publicaciones.contNot;
                                                                                                                    numrest = numNot - 1;
                                                                                                                    ganancias = publicaciones.ganancias;
                                                                                                                    if (ganancias === undefined) {
                                                                                                                        ganancias = 0;
                                                                                                                    } else {
                                                                                                                        ganancias = parseFloat(ganancias);
                                                                                                                    }
                                                                                                                    if (contSeg === 0) {
                                                                                                                        contSeg = 1;
                                                                                                                        if (ganancias === 0 || ganancias === undefined) {
                                                                                                                            var newData = {
                                                                                                                                seguidores: rCS,
                                                                                                                                contSeg: contSeg,
                                                                                                                                contNot: numrest,
                                                                                                                                new : 1,
                                                                                                                                ganancias: susM - (susM * .19)
                                                                                                                            };
                                                                                                                        } else if (ganancias > 0) {
                                                                                                                            gananciaNeta = susMInt + ganancias;
                                                                                                                            var newData = {
                                                                                                                                seguidores: rCS,
                                                                                                                                contSeg: contSeg,
                                                                                                                                contNot: numrest,
                                                                                                                                new : 1,
                                                                                                                                ganancias: gananciaNeta
                                                                                                                            };
                                                                                                                        }
                                                                                                                        var actualizarImg = {
                                                                                                                            seguidores: rCS,
                                                                                                                            contSeg: contSeg
                                                                                                                        };
                                                                                                                        docRef.update(newData).then(function () {
                                                                                                                            var nuevoSuscriptor = {
                                                                                                                                correoFoto: rCI,
                                                                                                                                correo: rCS,
                                                                                                                                newSus: nombre,
                                                                                                                                url: url,
                                                                                                                                contNotificacion: numrest
                                                                                                                            };
                                                                                                                            firebase.database().ref("likes/").push(nuevoSuscriptor).then(function () {
                                                                                                                                if (fecha11) {
                                                                                                                                    var f = moment(fecha11).add(30, 'days');
                                                                                                                                    fT = f.format('YYYY-MM-DD');
                                                                                                                                    var fechas = {
                                                                                                                                        correoS: rCS,
                                                                                                                                        correoI: rCI,
                                                                                                                                        fechaInicio: fecha11,
                                                                                                                                        fechaTerminacion: fT
                                                                                                                                    };
                                                                                                                                    firebase.firestore().collection('FECHAS').doc().set(fechas).then(function () {
                                                                                                                                        if (sigo === undefined || sigo === 0) {
                                                                                                                                            var newSeguidos = {
                                                                                                                                                seguidos: rCI,
                                                                                                                                                sigo: 1
                                                                                                                                            };
                                                                                                                                        } else {
                                                                                                                                            if (sigo > 0) {
                                                                                                                                                newCi = seguidos.toString() + "*" + rCI.toString();
                                                                                                                                                newSigo = sigo + 1;
                                                                                                                                                var newSeguidos = {
                                                                                                                                                    seguidos: newCi,
                                                                                                                                                    sigo: newSigo
                                                                                                                                                };
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        firebase.firestore().collection('IMAGENES').doc(uidCS).update(newSeguidos).then(function () {
                                                                                                                                            var ref = firebase.database().ref("Imagenes");
                                                                                                                                            var compdataImagen = $("#compdataPub").val();
                                                                                                                                            if (compdataImagen === "true") {
                                                                                                                                                ref.on("child_added", function (s) {
                                                                                                                                                    userdata = s.val();
                                                                                                                                                    if (userdata.correoI === rCI) {
                                                                                                                                                        var keys = s.key;
                                                                                                                                                        var refTab = firebase.database().ref("Imagenes/").child(keys);
                                                                                                                                                        refTab.update(actualizarImg);
                                                                                                                                                    }
                                                                                                                                                });
                                                                                                                                                setTimeout(function () {
                                                                                                                                                    location.href = urlRedireccionar;
                                                                                                                                                }, 3000);
                                                                                                                                            } else {
                                                                                                                                                location.href = urlRedireccionar;
                                                                                                                                            }
                                                                                                                                        });


                                                                                                                                    });
                                                                                                                                } else {
                                                                                                                                }

                                                                                                                            });
                                                                                                                        });
                                                                                                                    } else if (contSeg > 0) {
                                                                                                                        contSeg = contSeg + 1;
                                                                                                                        var seguidores = publicaciones.seguidores;
                                                                                                                        seguidores = seguidores + "*" + rCS;
                                                                                                                        if (ganancias === 0 || ganancias === undefined) {
                                                                                                                            var newData = {
                                                                                                                                seguidores: seguidores,
                                                                                                                                contSeg: contSeg,
                                                                                                                                contNot: numrest,
                                                                                                                                new : 1,
                                                                                                                                ganancias: susM - (susM * .19)
                                                                                                                            };
                                                                                                                        } else if (ganancias > 0) {
                                                                                                                            gananciaNeta = susMInt + ganancias;
                                                                                                                            var newData = {
                                                                                                                                seguidores: seguidores,
                                                                                                                                contSeg: contSeg,
                                                                                                                                contNot: numrest,
                                                                                                                                new : 1,
                                                                                                                                ganancias: gananciaNeta
                                                                                                                            };
                                                                                                                        }
                                                                                                                        var actualizarImg = {
                                                                                                                            seguidores: seguidores,
                                                                                                                            contSeg: contSeg
                                                                                                                        };
                                                                                                                        docRef.update(newData).then(function () {
                                                                                                                            var nuevoSuscriptor = {
                                                                                                                                correoFoto: rCI,
                                                                                                                                correo: rCS,
                                                                                                                                newSus: nombre,
                                                                                                                                url: url,
                                                                                                                                contNotificacion: numrest
                                                                                                                            };
                                                                                                                            firebase.database().ref("likes/").push(nuevoSuscriptor).then(function () {
                                                                                                                                if (fecha11) {
                                                                                                                                    var f = moment(fecha11).add(30, 'days');
                                                                                                                                    fT = f.format('YYYY-MM-DD');
                                                                                                                                    var fechas = {
                                                                                                                                        correoS: rCS,
                                                                                                                                        correoI: rCI,
                                                                                                                                        fechaInicio: fecha11,
                                                                                                                                        fechaTerminacion: fT
                                                                                                                                    };
                                                                                                                                    firebase.firestore().collection('FECHAS').doc().set(fechas).then(function () {
                                                                                                                                        if (sigo === undefined || sigo === 0) {
                                                                                                                                            var newSeguidos = {
                                                                                                                                                seguidos: rCI,
                                                                                                                                                sigo: 1
                                                                                                                                            };
                                                                                                                                        } else {
                                                                                                                                            if (sigo > 0) {
                                                                                                                                                newCi = seguidos.toString() + "*" + rCI.toString();
                                                                                                                                                newSigo = sigo + 1;
                                                                                                                                                var newSeguidos = {
                                                                                                                                                    seguidos: newCi,
                                                                                                                                                    sigo: newSigo
                                                                                                                                                };
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        firebase.firestore().collection('IMAGENES').doc(uidCS).update(newSeguidos).then(function () {
                                                                                                                                            var ref = firebase.database().ref("Imagenes");
                                                                                                                                            var compdataImagen = $("#compdataPub").val();
                                                                                                                                            if (compdataImagen === "true") {
                                                                                                                                                ref.on("child_added", function (s) {
                                                                                                                                                    userdata = s.val();
                                                                                                                                                    if (userdata.correoI === rCI) {
                                                                                                                                                        var keys = s.key;
                                                                                                                                                        var refTab = firebase.database().ref("Imagenes/").child(keys);
                                                                                                                                                        refTab.update(actualizarImg);
                                                                                                                                                    }
                                                                                                                                                });
                                                                                                                                                setTimeout(function () {
                                                                                                                                                    location.href = urlRedireccionar;
                                                                                                                                                }, 3000);
                                                                                                                                            } else {
                                                                                                                                                location.href = urlRedireccionar;
                                                                                                                                            }
                                                                                                                                        });

                                                                                                                                    });
                                                                                                                                } else {
                                                                                                                                }
                                                                                                                            });
                                                                                                                        });
                                                                                                                    }
                                                                                                                });
                                                                                                            });
                                                                                                });
                                                                                            }
                                                                                        } else if (coinsData === undefined || coinsData === 0) {
                                                                                            fire.collection("IMAGENES").where("nombre", "==", nombreUrl)
                                                                                                    .get()
                                                                                                    .then(function (querySnapshot) {
                                                                                                        querySnapshot.forEach(function (doc) {
                                                                                                            var publicaciones = doc.data();
                                                                                                            var rCI = publicaciones.mail;
                                                                                                            var doc = publicaciones.uid;
                                                                                                            var docRef = fire.collection('IMAGENES').doc(doc);
                                                                                                            var contSeg = publicaciones.contSeg;
                                                                                                            numNot = publicaciones.contNot;
                                                                                                            numrest = numNot - 1;
                                                                                                            ganancias = publicaciones.ganancias;
                                                                                                            if (ganancias === undefined) {
                                                                                                                ganancias = 0;
                                                                                                            } else {
                                                                                                                ganancias = parseFloat(ganancias);
                                                                                                            }

                                                                                                            if (contSeg === 0) {
                                                                                                                contSeg = 1;
                                                                                                                if (ganancias === 0 || ganancias === undefined) {
                                                                                                                    var newData = {
                                                                                                                        seguidores: rCS,
                                                                                                                        contSeg: contSeg,
                                                                                                                        contNot: numrest,
                                                                                                                        new : 1,
                                                                                                                        ganancias: susM - (susM * .19)
                                                                                                                    };
                                                                                                                } else if (ganancias > 0) {
                                                                                                                    gananciaNeta = susMInt + ganancias;
                                                                                                                    var newData = {
                                                                                                                        seguidores: rCS,
                                                                                                                        contSeg: contSeg,
                                                                                                                        contNot: numrest,
                                                                                                                        new : 1,
                                                                                                                        ganancias: gananciaNeta
                                                                                                                    };
                                                                                                                }
                                                                                                                var actualizarImg = {
                                                                                                                    seguidores: rCS,
                                                                                                                    contSeg: contSeg
                                                                                                                };
                                                                                                                docRef.update(newData).then(function () {
                                                                                                                    var nuevoSuscriptor = {
                                                                                                                        correoFoto: rCI,
                                                                                                                        correo: rCS,
                                                                                                                        newSus: nombre,
                                                                                                                        url: url,
                                                                                                                        contNotificacion: numrest
                                                                                                                    };
                                                                                                                    firebase.database().ref("likes/").push(nuevoSuscriptor).then(function () {
                                                                                                                        if (fecha11) {
                                                                                                                            var f = moment(fecha11).add(30, 'days');
                                                                                                                            fT = f.format('YYYY-MM-DD');
                                                                                                                            var fechas = {
                                                                                                                                correoS: rCS,
                                                                                                                                correoI: rCI,
                                                                                                                                fechaInicio: fecha11,
                                                                                                                                fechaTerminacion: fT
                                                                                                                            };
                                                                                                                            firebase.firestore().collection('FECHAS').doc().set(fechas).then(function () {
                                                                                                                                if (sigo === undefined || sigo === 0) {
                                                                                                                                    var newSeguidos = {
                                                                                                                                        seguidos: rCI,
                                                                                                                                        sigo: 1
                                                                                                                                    };
                                                                                                                                } else {
                                                                                                                                    if (sigo > 0) {
                                                                                                                                        newCi = seguidos.toString() + "*" + rCI.toString();
                                                                                                                                        newSigo = sigo + 1;
                                                                                                                                        var newSeguidos = {
                                                                                                                                            seguidos: newCi,
                                                                                                                                            sigo: newSigo
                                                                                                                                        };
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                firebase.firestore().collection('IMAGENES').doc(uidCS).update(newSeguidos).then(function () {
                                                                                                                                    var ref = firebase.database().ref("Imagenes");
                                                                                                                                    var compdataImagen = $("#compdataPub").val();
                                                                                                                                    if (compdataImagen === "true") {
                                                                                                                                        ref.on("child_added", function (s) {
                                                                                                                                            userdata = s.val();
                                                                                                                                            if (userdata.correoI === rCI) {
                                                                                                                                                var keys = s.key;
                                                                                                                                                var refTab = firebase.database().ref("Imagenes/").child(keys);
                                                                                                                                                refTab.update(actualizarImg);
                                                                                                                                            }
                                                                                                                                        });
                                                                                                                                        setTimeout(function () {
                                                                                                                                            location.href = urlRedireccionar;
                                                                                                                                        }, 3000);
                                                                                                                                    } else {
                                                                                                                                        location.href = urlRedireccionar;
                                                                                                                                    }
                                                                                                                                });

                                                                                                                            });
                                                                                                                        } else {
                                                                                                                        }

                                                                                                                    });
                                                                                                                });
                                                                                                            } else if (contSeg > 0) {
                                                                                                                contSeg = contSeg + 1;
                                                                                                                var seguidores = publicaciones.seguidores;
                                                                                                                seguidores = seguidores + "*" + rCS;
                                                                                                                if (ganancias === 0 || ganancias === undefined) {
                                                                                                                    var newData = {
                                                                                                                        seguidores: seguidores,
                                                                                                                        contSeg: contSeg,
                                                                                                                        contNot: numrest,
                                                                                                                        new : 1,
                                                                                                                        ganancias: susM - (susM * .19)
                                                                                                                    };
                                                                                                                } else if (ganancias > 0) {
                                                                                                                    gananciaNeta = susMInt + ganancias;
                                                                                                                    var newData = {
                                                                                                                        seguidores: seguidores,
                                                                                                                        contSeg: contSeg,
                                                                                                                        contNot: numrest,
                                                                                                                        new : 1,
                                                                                                                        ganancias: gananciaNeta
                                                                                                                    };
                                                                                                                }
                                                                                                                var actualizarImg = {
                                                                                                                    seguidores: seguidores,
                                                                                                                    contSeg: contSeg
                                                                                                                };
                                                                                                                docRef.update(newData).then(function () {
                                                                                                                    var nuevoSuscriptor = {
                                                                                                                        correoFoto: rCI,
                                                                                                                        correo: rCS,
                                                                                                                        newSus: nombre,
                                                                                                                        url: url,
                                                                                                                        contNotificacion: numrest
                                                                                                                    };
                                                                                                                    firebase.database().ref("likes/").push(nuevoSuscriptor).then(function () {
                                                                                                                        if (fecha11) {
                                                                                                                            var f = moment(fecha11).add(30, 'days');
                                                                                                                            fT = f.format('YYYY-MM-DD');
                                                                                                                            var fechas = {
                                                                                                                                correoS: rCS,
                                                                                                                                correoI: rCI,
                                                                                                                                fechaInicio: fecha11,
                                                                                                                                fechaTerminacion: fT
                                                                                                                            };
                                                                                                                            firebase.firestore().collection('FECHAS').doc().set(fechas).then(function () {
                                                                                                                                if (sigo === undefined || sigo === 0) {
                                                                                                                                    var newSeguidos = {
                                                                                                                                        seguidos: rCI,
                                                                                                                                        sigo: 1
                                                                                                                                    };
                                                                                                                                } else {
                                                                                                                                    if (sigo > 0) {
                                                                                                                                        newCi = seguidos.toString() + "*" + rCI.toString();
                                                                                                                                        newSigo = sigo + 1;
                                                                                                                                        var newSeguidos = {
                                                                                                                                            seguidos: newCi,
                                                                                                                                            sigo: newSigo
                                                                                                                                        };
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                firebase.firestore().collection('IMAGENES').doc(uidCS).update(newSeguidos).then(function () {
                                                                                                                                    var ref = firebase.database().ref("Imagenes");
                                                                                                                                    var compdataImagen = $("#compdataPub").val();
                                                                                                                                    if (compdataImagen === "true") {
                                                                                                                                        ref.on("child_added", function (s) {
                                                                                                                                            userdata = s.val();
                                                                                                                                            if (userdata.correoI === rCI) {
                                                                                                                                                var keys = s.key;
                                                                                                                                                var refTab = firebase.database().ref("Imagenes/").child(keys);
                                                                                                                                                refTab.update(actualizarImg);
                                                                                                                                            }
                                                                                                                                        });
                                                                                                                                        setTimeout(function () {
                                                                                                                                            location.href = urlRedireccionar;
                                                                                                                                        }, 3000);
                                                                                                                                    } else {
                                                                                                                                        location.href = urlRedireccionar;
                                                                                                                                    }
                                                                                                                                });

                                                                                                                            });
                                                                                                                        } else {
                                                                                                                        }
                                                                                                                    });
                                                                                                                });
                                                                                                            }
                                                                                                        });
                                                                                                    });
                                                                                        }
                                                                                    });
                                                                                }).catch((error) => {
                                                                        });
                                                                    });
                                                                });
                                                    });
                                                } else {
                                                    location.replace("publicaciones.html");
                                                }
                                            } else {
                                                location.replace("publicaciones.html");
                                            }
                                        });
                                    }).catch(function (error) {
                                location.replace("publicaciones.html");
                            });
                        } else {
                            if (var2 === "rSa1eu") {
                                fire.collection("orders").where("correo", "==", mail)
                                        .get()
                                        .then(function (querySnapshot) {
                                            querySnapshot.forEach(function (doc) {
                                                var publicaciones = doc.data();
                                                var checkoutSessionId = publicaciones.checkoutSessionId;
                                                var paymentStatus = publicaciones.paymentStatus;
                                                if (checkoutSessionId) {
                                                    if (paymentStatus === "paid") {
                                                        docID = doc.id;
                                                        amount = publicaciones.amountTotal;
                                                        coins = parseInt(amount) / 100;
                                                        fire.collection("orders").doc(docID).delete().then(function () {
                                                            fire.collection("IMAGENES").where("mail", "==", rCS)
                                                                    .get()
                                                                    .then(function (querySnapshot) {
                                                                        querySnapshot.forEach(function (doc) {
                                                                            var publicaciones = doc.data();
                                                                            doc = publicaciones.uid;
                                                                            var docRef = fire.collection('IMAGENES').doc(doc);
                                                                            var coinsData = publicaciones.coins;
                                                                            if (coinsData) {
                                                                                coinsVal = coinsData + coins;
                                                                                var newData = {
                                                                                    coins: coinsVal
                                                                                };
                                                                                docRef.update(newData).then(function () {
                                                                                    location.replace("tienda.html");
                                                                                }).catch((error) => {
                                                                                });
                                                                            } else if (coinsData === undefined || coinsData === 0) {
                                                                                var newData = {
                                                                                    coins: coins
                                                                                };
                                                                                docRef.update(newData).then(function () {
                                                                                    location.replace("tienda.html");
                                                                                }).catch((error) => {
                                                                                });
                                                                            }
                                                                        });
                                                                    }).catch((error) => {
                                                            });
                                                        });
                                                    } else {
                                                        location.replace("publicaciones.html");
                                                    }
                                                } else {
                                                    location.replace("publicaciones.html");
                                                }
                                            });
                                        });
                            } else {
                                location.reload("publicaciones.html");
                            }
                        }
                    });
                } else {
                    location.replace("index.html");
                }
            });
        </script>
    </body>
</html>
